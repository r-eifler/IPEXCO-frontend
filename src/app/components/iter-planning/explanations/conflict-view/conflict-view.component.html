<mat-card appearance="outlined" class="outer-container">
  @if (!(solvable$ | async)) {
    <div
      class="card-container"
      *ngIf="(dependencies$ | async).length > 0 && (solvableAtAll$ | async)">
      <mat-card-header>
        <mat-card-title>
          The selected soft goals are not solvable. There are the following
          conflicts ...
        </mat-card-title>
      </mat-card-header>
      <mat-accordion multi>
        <mat-expansion-panel
          hideToggle
          *ngFor="let conflict of dependencies$ | async; let i = index"
          expanded="true"
          [class.selected]="selectedConflictIndex == i">
          <mat-expansion-panel-header>
            <mat-panel-title> Conflict {{ i + 1 }} </mat-panel-title>
          </mat-expansion-panel-header>
          <mat-list>
            <mat-list-item *ngFor="let pp of conflict">
              <span matLine>{{ pp.naturalLanguageDescription }}</span>
              <span *ngIf="( settings$ | async).usePlanPropertyValues" matLine> Utility: {{ pp.value }} </span>
            </mat-list-item>
          </mat-list>
          <div
            class="button-container"
            *ngIf="provideRelaxationExplanations$ | async">
            <button
              mat-stroked-button
              color="primary"
              (click)="selectConflictStepUnsolvable(conflict, i)">
              Possible Relaxations
            </button>
          </div>
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  }

  @if (solvable$ | async){
    <mat-card-header *ngIf="(question$ | async)">

      <mat-card-title *ngIf="(dependencies$ | async).length > 0 && (solvableAtAll$ | async)">
        ... because to satisfy soft goal 
      </mat-card-title>
      <mat-card-title *ngIf="(dependencies$ | async).length == 0 && (solvableAtAll$ | async)">
        The selected soft goal has no conflicts.
      </mat-card-title>

    </mat-card-header>
    <div *ngIf="!(question$ | async)">
      <p style="font-size: large;">No soft goal selected.</p>
    </div>

    @if ((question$ | async) && (explanation$ | async)) {
      <mat-card appearance="outlined">
        <div class="list-item-container" >
          <mat-icon matListIcon>{{(question$ | async).icon}}</mat-icon>
          <div class="list-item-text">
            <span style="font-size: larger">
              {{ (question$ | async).naturalLanguageDescription }}
            </span>
            <span *ngIf="( settings$ | async).usePlanPropertyValues"> Utility: {{ (question$ | async).value }} </span>
          </div>
        </div>
      </mat-card>
      <mat-card appearance="outlined" class="card-container" *ngIf="(dependencies$ | async).length > 0 && (solvableAtAll$ | async)">
        <mat-card-header>
          <mat-card-title>you have to forgo at least one goal in each of the following conflicts ...</mat-card-title>
        </mat-card-header>
        <mat-accordion multi style="margin: 20px;">
          <mat-expansion-panel
            hideToggle
            *ngFor="let conflict of dependencies$ | async; let i = index"
            expanded="true"
            [class.selected]="selectedConflictIndex == i">
            <mat-expansion-panel-header>
              <mat-panel-title> Conflict {{ i + 1 }} </mat-panel-title>
            </mat-expansion-panel-header>
            <mat-list>
              @for (pp of conflict; track pp) {
                <mat-list-item>
                    <mat-icon matListItemIcon>{{ pp.icon }}</mat-icon>
                    <h3 matListItemTitle>{{ pp.naturalLanguageDescription }}</h3>
                    @if (( settings$ | async).usePlanPropertyValues) {
                    <p matListItemLine>
                      <span>Utility: {{ pp.value }}</span>
                    </p>
                    }
                    @if (!$last) {
                      <mat-divider inset="true"></mat-divider>
                    }
                </mat-list-item>
              }
            </mat-list>
            <div
              class="button-container"
              *ngIf="provideRelaxationExplanations$ | async">
              <button
                mat-stroked-button
                color="primary"
                (click)="selectConflict(conflict, i)">
                Possible Relaxations
              </button>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </mat-card>
      <mat-card class="card-container" *ngIf="!(solvableAtAll$ | async)">
        <mat-card-header>
          <mat-card-title>can with the current constraints not be achieved.</mat-card-title>
        </mat-card-header>
        <div
          class="button-container"
          *ngIf="provideRelaxationExplanations$ | async">
          <button
            mat-stroked-button
            color="primary"
            (click)="selectPreferenceUnsolvable(-1)">
            Possible Relaxations
          </button>
        </div>
      </mat-card>
    }
  }
</mat-card>
